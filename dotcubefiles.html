<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Internet Cube - Dot Cube Files</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="css/main.css" />
</head>

<body class="nojs">
  <header>
    <h1><span>Dot Cube</span> Files</h1>
  </header>

  <main>
    <section>
      <h2 id="what"><span>What is</span> a dot cube file?</h2>

      <p>A <em>dot cube</em> file (e.g. <em>config.cube</em>) is a single configuration file containing all of the necessary settings and keys for connecting an <a href="http://internetcu.be">Internet Cube</a> to a remote VPN server. This file can be used on the web interface of <a href="https://github.com/labriqueinternet/vpnclient_ynh/">VPN Client</a>, under the <em>Automatic</em> tab. It should be provided ready to use, by the VPN access provider.</p>

      <div class="pictures">
        <img src="img/vpnclient-automatic.png" alt="Automatic Tab" /><br />
      </div>

      <p>A <em>dot cube</em> file is just a Json file. The following sections are intended to explain to VPN providers how to create <em>dot cube</em> files for their members.</p>
    </section>

    <section>
      <h2 id="example"><span>Json</span> example</h2>

      <pre>
{
  "server_name": "vpn.ldn-fai.net",
  "server_port": "1194",
  "server_proto": "udp",
  "ip6_net": "2001:db8:c42::",
  "crt_server_ca": "-----BEGIN CERTIFICATE-----|MIIFFXAJjzZhAZJ+JHA<span>&hellip;</span>eRte6K|-----END CERTIFICATE-----",
  "crt_client": "-----BEGIN CERTIFICATE-----|MIIFbUHHQjauIUoiUAA5ax<span>&hellip;</span>4T3As=|-----END CERTIFICATE-----",
  "crt_client_key": "-----BEGIN PRIVATE KEY-----|MIIEvM/JsSAmledzvE<span>&hellip;</span>i8kAMj|-----END PRIVATE KEY-----",
  "crt_client_ta": "",
  "login_user": "",
  "login_passphrase": "",
  "dns0": "89.234.141.66",
  "dns1": "2001:913::8",
  "openvpn_rm": [ ],
  "openvpn_add": [ "topology subnet" ]
}
</pre>
    </section>

    <section>
      <h2 id="settings"><span>Json</span> settings</h2>

      <table id="cubefilestable">
        <tr>
          <th class="cubekey">Key</th>
          <th class="cubevalue">Value Type</th>
          <th class="cubeoptional">Optional</th>
          <th class="cubecomment">Comment</th>
        </tr>
        <tr>
          <td class="cubekey">server_name</td>
          <td class="cubevalue">Domain name</td>
          <td class="cubeoptional cubeoptionalno">No</td>
          <td class="cubecomment">Remote VPN server address</td>
        </tr>
        <tr>
          <td class="cubekey">server_port</td>
          <td class="cubevalue">Port number</td>
          <td class="cubeoptional cubeoptionalno">No</td>
          <td class="cubecomment">Remote VPN server port</td>
        </tr>
        <tr>
          <td class="cubekey">server_proto</td>
          <td class="cubevalue">"udp" or "tcp"</td>
          <td class="cubeoptional cubeoptionalno">No</td>
          <td class="cubecomment">L4 protocol to use</td>
        </tr>
        <tr>
          <td class="cubekey">ip6_net</td>
          <td class="cubevalue">IPv6 network address</td>
          <td class="cubeoptional cubeoptionalyes">Yes</td>
          <td class="cubecomment">IPv6 delegated prefix</td>
        </tr>
        <tr>
          <td class="cubekey">crt_server_ca</td>
          <td class="cubevalue">ASCII certificate (new lines replaced by pipes)</td>
          <td class="cubeoptional cubeoptionalno">No</td>
          <td class="cubecomment">Public server CA (.crt)</td>
        </tr>
        <tr>
          <td class="cubekey">crt_client</td>
          <td class="cubevalue">ASCII certificate (new lines replaced by pipes)</td>
          <td class="cubeoptional cubeoptionalyes">Yes (except if <em>crt_client_key</em> is defined)</td>
          <td class="cubecomment">Public client certificate (.crt)</td>
        </tr>
        <tr>
          <td class="cubekey">crt_client_key</td>
          <td class="cubevalue">ASCII certificate (new lines replaced by pipes)</td>
          <td class="cubeoptional cubeoptionalyes">Yes (except if <em>crt_client</em> is defined)</td>
          <td class="cubecomment">Private client certificate (.key)</td>
        </tr>
        <tr>
          <td class="cubekey">crt_client_ta</td>
          <td class="cubevalue">ASCII certificate (new lines replaced by pipes)</td>
          <td class="cubeoptional cubeoptionalyes">Yes</td>
          <td class="cubecomment">Shared-secret (ta.key)</td>
        </tr>
        <tr>
          <td class="cubekey">login_user</td>
          <td class="cubevalue">Username</td>
          <td class="cubeoptional cubeoptionalyes">Yes (except if <em>login_passphrase</em> is defined)</td>
          <td class="cubecomment">Username</td>
        </tr>
        <tr>
          <td class="cubekey">login_passphrase</td>
          <td class="cubevalue">Passphrase</td>
          <td class="cubeoptional cubeoptionalyes">Yes (except if <em>login_user</em> is defined)</td>
          <td class="cubecomment">Password</td>
        </tr>
        <tr>
          <td class="cubekey">dns0</td>
          <td class="cubevalue">IPv6 or IPv4 address</td>
          <td class="cubeoptional cubeoptionalno">No</td>
          <td class="cubecomment">First public DNS resolver (will be set on the host)</td>
        </tr>
        <tr>
          <td class="cubekey">dns1</td>
          <td class="cubevalue">IPv6 or IPv4 address</td>
          <td class="cubeoptional cubeoptionalno">No</td>
          <td class="cubecomment">Second public DNS resolver (will be set on the host)</td>
        </tr>
        <tr>
          <td class="cubekey">openvpn_rm</td>
          <td class="cubevalue">Array of strings or PCRE regexes</td>
          <td class="cubeoptional cubeoptionalyes">Yes</td>
          <td class="cubecomment">OpenVPN options to remove from the <a href="https://github.com/labriqueinternet/vpnclient_ynh/blob/master/conf/openvpn_client.conf.tpl">default configuration</a> (remove all lines containing one of the strings/regexes &mdash; non case-sensitive)</td>
        </tr>
        <tr>
          <td class="cubekey">openvpn_add</td>
          <td class="cubevalue">Array of "key value" pairs</td>
          <td class="cubeoptional cubeoptionalyes">Yes</td>
          <td class="cubecomment">OpenVPN options to add to the <a href="https://github.com/labriqueinternet/vpnclient_ynh/blob/master/conf/openvpn_client.conf.tpl">default configuration</a></td>
        </tr>
      </table>

      <p>
        <strong>Note<sup>1</sup>:</strong> You have to define either a public/private certificates couple, either a user/passphrase couple, either both.<br />
        <strong>Note<sup>2</sup>:</strong> You also have to set the same <em>IPv6 Delegated Prefix</em> in the web interface of <a href="https://github.com/labriqueinternet/hotspot_ynh/">Wifi Hotspot</a>, for delivering IPv6 to wifi clients.
      </p>
    </section>

    <section>
      <h2 id="cli"><span>Command</span>-line</h2>

      <p>VPN Client can be configured with a <em>dot cube</em> file, directly in command-line:</p>

      <pre>
% ynh-vpnclient-loadcubefile.sh -h
-u YunoHost username (user with permissions on VPN Client)
-p User password
-c Dot cube file path
-h This help

% ynh-vpnclient-loadcubefile.sh -u jdoe -p AAaxRjLAyU4CU -c /tmp/config.cube
[VPN] Configuration updated and service successfully reloaded
</pre>

      <p>The script <em>ynh-vpnclient-loadcubefile.sh</em> is provided with VPN Client.</p>

      <p>The user <em>jdoe:AAaxRjLAyU4CU</em> must be a valid YunoHost user (SSO), allowed to access to the VPN Client web interface. When Wifi Hotspot is detected and if there is only one SSID defined, the <em>IPv6 Delegated Prefix</em> is also configured for this SSID and Wifi Hotspot is restarted.</p>
    </section>
  </main>

  <footer>
    <a href="http://internetcu.be">Internet Cube</a>
  </footer>

  <script type="text/javascript" src="js/main.js"></script>
</body>
</html>
